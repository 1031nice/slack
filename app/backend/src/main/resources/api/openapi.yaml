openapi: 3.0.3
info:
  title: Slack API
  description: Slack clone application API specification
  version: 1.0.0
servers:
  - url: http://localhost:8080/api
    description: Local development server

paths:
  # User APIs
  /users:
    post:
      summary: Create a new user
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreateRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get all users
      tags:
        - Users
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'

  /users/{userId}:
    get:
      summary: Get user by ID
      tags:
        - Users
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  # Workspace APIs
  /workspaces:
    post:
      summary: Create a new workspace
      tags:
        - Workspaces
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkspaceCreateRequest'
      responses:
        '201':
          description: Workspace created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Owner user not found

    get:
      summary: Get all workspaces for current user
      tags:
        - Workspaces
      responses:
        '200':
          description: List of workspaces
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WorkspaceResponse'

  /workspaces/{workspaceId}:
    get:
      summary: Get workspace by ID
      tags:
        - Workspaces
      parameters:
        - name: workspaceId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Workspace details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /workspaces/{workspaceId}/members:
    post:
      summary: Add member to workspace
      tags:
        - Workspaces
      parameters:
        - name: workspaceId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkspaceMemberCreateRequest'
      responses:
        '201':
          description: Member added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceMemberResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: User is already a member

    get:
      summary: Get workspace members
      tags:
        - Workspaces
      parameters:
        - name: workspaceId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: List of workspace members
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WorkspaceMemberResponse'

  # Channel APIs
  /workspaces/{workspaceId}/channels:
    post:
      summary: Create a new channel
      tags:
        - Channels
      parameters:
        - name: workspaceId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChannelCreateRequest'
      responses:
        '201':
          description: Channel created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChannelResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Workspace not found

    get:
      summary: Get all channels in workspace
      tags:
        - Channels
      parameters:
        - name: workspaceId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: List of channels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ChannelResponse'

  /channels/{channelId}:
    get:
      summary: Get channel by ID
      tags:
        - Channels
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Channel details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChannelResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /channels/{channelId}/members:
    post:
      summary: Add member to channel
      tags:
        - Channels
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChannelMemberCreateRequest'
      responses:
        '201':
          description: Member added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChannelMemberResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: User is already a member

    get:
      summary: Get channel members
      tags:
        - Channels
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: List of channel members
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ChannelMemberResponse'

  # Message APIs
  /channels/{channelId}/messages:
    post:
      summary: Send a message to channel
      tags:
        - Messages
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageCreateRequest'
      responses:
        '201':
          description: Message sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Channel or user not found

    get:
      summary: Get messages in channel
      tags:
        - Messages
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
        - name: before
          in: query
          description: Message ID to fetch messages before (pagination)
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: List of messages
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MessageResponse'

  /messages/{messageId}:
    get:
      summary: Get message by ID
      tags:
        - Messages
      parameters:
        - name: messageId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Message details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /messages/{messageId}/replies:
    get:
      summary: Get replies to a message (thread)
      tags:
        - Messages
      parameters:
        - name: messageId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: List of reply messages
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MessageResponse'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      summary: Reply to a message (create thread)
      tags:
        - Messages
      parameters:
        - name: messageId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageCreateRequest'
      responses:
        '201':
          description: Reply sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  # Reaction APIs
  /messages/{messageId}/reactions:
    post:
      summary: Add reaction to message
      tags:
        - Reactions
      parameters:
        - name: messageId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReactionCreateRequest'
      responses:
        '201':
          description: Reaction added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReactionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Reaction already exists

    get:
      summary: Get reactions for a message
      tags:
        - Reactions
      parameters:
        - name: messageId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: List of reactions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReactionResponse'

  /messages/{messageId}/reactions/{reactionId}:
    delete:
      summary: Remove reaction from message
      tags:
        - Reactions
      parameters:
        - name: messageId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: reactionId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Reaction removed successfully
        '404':
          $ref: '#/components/responses/NotFound'

components:
  schemas:
    UserCreateRequest:
      type: object
      required:
        - email
        - name
        - password
      properties:
        email:
          type: string
          format: email
        name:
          type: string
          minLength: 1
          maxLength: 255
        password:
          type: string
          minLength: 8

    UserResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        email:
          type: string
        name:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    WorkspaceCreateRequest:
      type: object
      required:
        - name
        - ownerId
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
        ownerId:
          type: integer
          format: int64

    WorkspaceResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        ownerId:
          type: integer
          format: int64
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    WorkspaceMemberCreateRequest:
      type: object
      required:
        - userId
        - role
      properties:
        userId:
          type: integer
          format: int64
        role:
          type: string
          enum:
            - OWNER
            - ADMIN
            - MEMBER
          default: MEMBER

    WorkspaceMemberResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        workspaceId:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        role:
          type: string
        joinedAt:
          type: string
          format: date-time

    ChannelCreateRequest:
      type: object
      required:
        - name
        - type
        - createdBy
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
        type:
          type: string
          enum:
            - PUBLIC
            - PRIVATE
        createdBy:
          type: integer
          format: int64

    ChannelResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        workspaceId:
          type: integer
          format: int64
        name:
          type: string
        type:
          type: string
        createdBy:
          type: integer
          format: int64
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ChannelMemberCreateRequest:
      type: object
      required:
        - userId
        - role
      properties:
        userId:
          type: integer
          format: int64
        role:
          type: string
          enum:
            - ADMIN
            - MEMBER
          default: MEMBER

    ChannelMemberResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        channelId:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        role:
          type: string
        joinedAt:
          type: string
          format: date-time

    MessageCreateRequest:
      type: object
      required:
        - userId
        - content
      properties:
        userId:
          type: integer
          format: int64
        content:
          type: string
          minLength: 1

    MessageResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        channelId:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        content:
          type: string
        parentMessageId:
          type: integer
          format: int64
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ReactionCreateRequest:
      type: object
      required:
        - userId
        - emoji
      properties:
        userId:
          type: integer
          format: int64
        emoji:
          type: string
          minLength: 1
          maxLength: 50

    ReactionResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        messageId:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        emoji:
          type: string
        createdAt:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        timestamp:
          type: string
          format: date-time

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

