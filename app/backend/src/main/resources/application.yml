spring:
  application:
    name: slack
  profiles:
    active: dev

  datasource:
    url: jdbc:postgresql://localhost:5432/slack_db
    username: slack_user
    password: slack_pass
    driver-class-name: org.postgresql.Driver
  
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: true
    properties:
      hibernate:
        format_sql: true
  
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
  
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://localhost:8081
          jwk-set-uri: http://localhost:8081/oauth2/jwks
  
  # Redis configuration for Pub/Sub messaging
  data:
    redis:
      host: localhost
      port: 6380
      timeout: 2000ms

  # Kafka configuration for read receipt persistence (v0.4.1)
  kafka:
    bootstrap-servers: localhost:9092
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      acks: 1  # Leader ack (balance between latency and durability)
      retries: 3
      properties:
        linger.ms: 10  # Wait up to 10ms to batch records
        compression.type: snappy  # Compress messages for efficiency
    consumer:
      group-id: read-receipt-persister
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      auto-offset-reset: earliest
      max-poll-records: 500  # Batch size for consumer
      properties:
        spring.json.trusted.packages: com.slack.dto.events
        # Enable idempotent consumer (exactly-once processing)
        enable.auto.commit: false  # Manual commit after successful DB write
    listener:
      ack-mode: manual  # Manual ack for better control

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    disable-swagger-default-url: true
    config-url: /api-docs/swagger-config
    url: /api-docs

# Server port is configured via profile-specific files:
# - application-9000.yml (default)
# - application-9001.yml
# - application-9002.yml
# Use --spring.profiles.active=9001 or 9002 to run on different ports
server:
  port: 9000
  address: 0.0.0.0  # 모든 네트워크 인터페이스에 바인딩

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
  metrics:
    export:
      prometheus:
        enabled: true

# Auth Server Configuration
auth:
  server:
    url: http://localhost:8081
  client:
    # Client ID and secret must match the client registered in the auth server
    # The auth server automatically registers this client on startup with:
    # - clientId: "slack"
    # - clientSecret: "slack-secret-key"
    # - scopes: ["read", "write"]
    # - grantTypes: ["authorization_code", "refresh_token", "client_credentials"]
    id: slack
    secret: slack-secret-key
    redirect-uris: http://localhost:3000/auth/callback,http://localhost:3000/signup/callback,http://localhost:3000/callback
    # Auto-register OAuth2 client on startup (not needed if auth server auto-registers)
    # If false, you need to register the client manually at {auth.server.url}/api/v1/oauth2/clients
    auto-register: false

